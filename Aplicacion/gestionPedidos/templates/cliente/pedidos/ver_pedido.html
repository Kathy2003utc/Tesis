{% extends 'cliente/plantilla.html' %}
{% load static %}
{% block contenido %}

<style>
:root {
    --cafe-oscuro: #b4764f;
    --cafe-medio: #cd966c;
    --cafe-claro: #D7B999;
    --cafe-suave: #EEDDC6;
    --verde: #3E7A3F;
    --blanco-calido: #F8F5F2;
    --gris-suave: #E2DED8;
    --texto-oscuro: #2B1A10;
    --rojo-alerta: #C14949;
    --azul-pizarra: #4F6D7A;
    --exito: #4F8A57;
    --naranja-tierra: #D98555;
}

.titulo-pedido {
    color: var(--cafe-oscuro);
    font-weight: 800;
    text-align: center;
    margin-bottom: 20px;
}

.btn-regresar {
    background: var(--azul-pizarra);
    color: white;
    font-weight: bold;
    border-radius: 10px;
    padding: 10px 18px;
    transition: .3s;
}
.btn-regresar:hover {
    background: #4A3F38;
    color: white;
}

.resumen-pedido {
    background: var(--cafe-suave);
    border-radius: 18px;
    padding: 25px;
    box-shadow: 0 10px 22px rgba(0,0,0,.08);
    border: 1px solid var(--cafe-claro);
}

.resumen-header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
    border-bottom: 1px dashed var(--cafe-medio);
    padding-bottom: 15px;
    margin-bottom: 20px;
}

.resumen-codigo {
    font-size: 20px;
    font-weight: 800;
    color: var(--cafe-oscuro);
}

.resumen-total {
    font-size: 22px;
    font-weight: 800;
    color: var(--exito);
}

.resumen-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
}

.resumen-item {
    background: white;
    border-radius: 14px;
    padding: 14px 16px;
    border-left: 5px solid var(--cafe-medio);
    box-shadow: 0 6px 14px rgba(0,0,0,.06);
}

.resumen-item small {
    display: block;
    font-weight: 700;
    color: #4A3F38;
    margin-bottom: 4px;
}

.badge-creacion{
    background-color: var(--naranja-tierra) !important;
}

.separador {
    border-top: 1px dashed var(--cafe-medio);
    margin: 25px 0;
}

.subtitulo-seccion {
    font-weight: 800;
    color: var(--cafe-oscuro);
    margin-bottom: 15px;
}

/* ===============================
   TABLA DETALLE – ESTILO UNIFICADO
   (igual a la segunda imagen)
================================ */

#tbl_detalles {
    min-width: 900px;
    background: white;
}

#tbl_detalles thead th {
    background-color: var(--cafe-crema);
    color: var(--texto-oscuro);
    font-size: 15px;
    font-weight: 800;
    text-align: center;
    vertical-align: middle;
    border-bottom: 2px solid var(--cafe-medio);
}

#tbl_detalles tbody td {
    text-align: center;
    vertical-align: middle;
    font-size: 14.5px;
}

#tbl_detalles tbody tr:hover {
    background-color: var(--gris-suave);
}

#tbl_detalles td:first-child {
    text-align: left;
    font-weight: 600;
}

/* FOOTER */
#tbl_detalles tfoot tr {
    background-color: #fff;
}

#tbl_detalles tfoot td,
#tbl_detalles tfoot th {
    font-weight: 800;
    font-size: 15px;
}

/* Colores */
#tbl_detalles .recargo-valor {
    color: #f0a500;
}

#tbl_detalles .total-valor {
    color: var(--exito);
}

</style>

<div class="main-content-wrapper">
    <div class="container mt-5">

        <h2 class="titulo-pedido">
            Detalle del Pedido a Domicilio
        </h2>

        <div class="mb-3">
            <a href="{% url 'cliente_listar_pedidos' %}" class="btn btn-regresar">
                <i class="fas fa-arrow-left me-2"></i> Regresar
            </a>
        </div>

        <!-- RESUMEN PEDIDO + PAGO -->
        <div class="resumen-pedido mb-4">

            <!-- HEADER -->
            <div class="resumen-header">
                <div class="resumen-codigo">
                    {{ pedido.codigo_pedido }}
                </div>

                <div>
                    {% if pedido.estado == 'en_creacion' %}
                        <span class="badge badge-creacion">En creación</span>
                    {% elif pedido.estado == 'aceptado' %}
                        <span class="badge bg-info">Aceptado</span>
                    {% elif pedido.estado == 'en preparacion' %}
                        <span class="badge bg-warning">En preparación</span>
                    {% elif pedido.estado == 'listo' %}
                        <span class="badge bg-success">Listo</span>
                    {% elif pedido.estado == 'finalizado' %}
                        <span class="badge bg-primary">Finalizado</span>
                    {% endif %}
                </div>

                <div class="resumen-total">
                    ${{ pedido.total|floatformat:2 }}
                </div>
            </div>

            <!-- DATOS DEL PEDIDO -->
            <div class="resumen-grid">
                <div class="resumen-item">
                    <small>Cliente</small>
                    <span>{{ pedido.cliente.nombre }} {{ pedido.cliente.apellido }}</span>
                </div>

                <div class="resumen-item">
                    <small>Contacto</small>
                    <span>{{ pedido.contacto_cliente }}</span>
                </div>

                <div class="resumen-item">
                    <small>Dirección de entrega</small>
                    <span>{{ pedido.direccion_entrega }}</span>
                </div>

                <div class="resumen-item">
                    <small>Tipo de pedido</small>
                    <span>Domicilio</span>
                </div>
            </div>

            <!-- SEPARADOR -->
            <div class="separador"></div>

            <!-- DATOS DE PAGO -->
            <h5 class="subtitulo-seccion">Información de Pago</h5>

            {% if comprobante %}
            <div class="resumen-grid">

                <div class="resumen-item">
                    <small>N° Comprobante</small>
                    <span>{{ comprobante.numero_comprobante }}</span>
                </div>

                {% if comprobante.imagen %}
                <div class="resumen-item">
                    <small>Comprobante</small>
                    <a href="{{ comprobante.imagen.url }}" target="_blank"
                    class="btn btn-sm btn-outline-primary">
                        Ver imagen
                    </a>
                </div>
                {% endif %}

            </div>
            {% else %}
            <div class="alert alert-warning mb-0">
                Este pedido aún no tiene comprobante de pago.
            </div>
            {% endif %}

        </div>


        <!-- TABLA DETALLES -->
        <h4 class="mb-3" style="color: var(--cafe-oscuro); font-weight:700;">
            Detalles del pedido
        </h4>

        <div class="table-responsive mt-3">
            <table class="table table-bordered table-hover align-middle" id="tbl_detalles">

                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Valor unitario</th>
                        <th>Subtotal</th>
                        <th>Observación</th>
                    </tr>
                </thead>

                <tbody>
                    {% for d in pedido.detalles.all %}
                    <tr>
                        <td>{{ d.producto.nombre }}</td>
                        <td>{{ d.cantidad }}</td>
                        <td>${{ d.precio_unitario|floatformat:2 }}</td>
                        <td>${{ d.subtotal|floatformat:2 }}</td>
                        <td>{{ d.observacion|default:"-" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            No hay productos agregados.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>

                {% if pedido.detalles.exists %}
                <tfoot>

                    <!-- RECARGO -->
                    <tr class="fila-recargo">
                        <th colspan="3" class="text-end">RECARGO:</th>
                        <th class="text-center recargo-valor">
                            ${{ pedido.recargo_mostrar|floatformat:2 }}
                        </th>
                        <th></th>
                    </tr>

                    <!-- TOTAL FINAL -->
                    <tr class="fila-total">
                        <th colspan="3" class="text-end">TOTAL FINAL:</th>
                        <th class="text-center total-valor">
                            ${{ pedido.total|floatformat:2 }}
                        </th>
                        <th></th>
                    </tr>

                </tfoot>
                {% endif %}

            </table>
        </div>


    </div>
</div>

{% endblock %}